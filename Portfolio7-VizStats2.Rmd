---
title: "Portfolio7-VizStats2"
output: html_document
date: 'April 13, 2022'
---

Picking up where Portfolio 6 left off, I wanted to see how correlations change over time, and provide a statistic for that correlation within the graph itself. Doing this with time series data presented analytic/visualization difficulties, as I saw in Portfolio 6.

1) First, installing packages / libraries, and -of course- our awesome "Stop the errors" code. 

```{r Stop the errors!}
r = getOption("repos")
r["CRAN"] = "http://cran.us.r-project.org"
options(repos = r)
```

```{r Packages}
install.packages('tidyr')
install.packages('readr')
```

```{r Library}
library(ggplot2)
library(tidyr)
```


```{r dplyr install} 
install.packages("dplyr")
```


```{r dplyr library} 
library(dplyr)
```


2) Next, read my Excel doc into a dataframe
```{r Read data from CSV into a dataframe}
library(readr)
dfMil <-read.csv("~/Documents/GitHub/Portfolio7-VizStats2/dfMil.csv")
View(dfMil)
```

3) I'm going to make two graphs with two different formats of data frame, the second format being long form data. I have a feeling this might come in handy.

```{r Line graph two variables (separate in df) over time}
colors <- c("Suic" = "red", "CD" = "orange")
ggplot(dfMil, aes(x=Time)) +
  geom_line(aes(y = Suic, color = "Suic"), size = 1.5) +
  geom_line(aes(y = CD, color="CD"), size = 1.5) +
labs(                                
   x = "Year",
   y = "-number-",
   color = "Legend"
 ) +
scale_color_manual(values = colors) +
theme(text = element_text(size=7),
        axis.text.x = element_text(angle=45, hjust=1))
```

4) This uses long form data frame:

```{r r Line graph two variables over time (long format)}
ggplot(MilStatsExcel, aes(Time, Value, group = Object, color = Object)) + 
  geom_line(size=1) +   
  geom_point(size = 2)
```

5) Now that we have the variables depicted in the graph, I am going to use R to insert the text box containing a statistical figure into the graph.

As data accumulate over time, the correlation would presumably change as well, unless the relationship between the variables remained exactly the same over time. As the years pass, new data become available for each variable. Conceptually, this is an outline:

Data Point 1: Correlation between X and Y in 2000 

Data Point 2: Correlation between X and Y in 2001 (data for years 2000-2001) 

Data Point 3: Correlation between X and Y in 2002 (data for years 2000-2002) etc. etc.

In other words, it is the cumulative correlation that I want to capture, to match the visual depiction of the way military suicide relates to combat deaths over time.

Here we go! First, we'll need ggrepel for the Text boxes.

```{r Text into graph1}
install.packages("ggrepel")
library(ggrepel)
```

Now, for the main event! There is a manual method for inserting text boxes. This requires designating a specific location for each individual text box. 

```{r Text box into graph, manaul method}
colors <- c("Suic" = "red", "CD" = "orange")
ggplot(dfMil, aes(x=Time)) +
  geom_line(aes(y = Suic, color = "Suic"), size = 1.5) +
  geom_line(aes(y = CD, color="CD"), size = 1.5) +
labs(                                
   x = "Year",
   y = "-number-",
   color = "Legend"
 ) +
scale_color_manual(values = colors) +
theme(text = element_text(size=7),
        axis.text.x = element_text(angle=45, hjust=1)) +
geom_text(x=2000, y=300, label="Text1") +
annotate(geom="text", x=2005, y=300, label="Text2",
              color="red")
```

That is one way to do it. But it would be preferable if there were a code to conveniently enter multiple text boxes in a more concise way. LEFT OFF HERE 

Notes:
There were a couple of irregularities in Excel: 2000-2002 gave me a non-numeric result. 2012 also gave Excel some trouble. The correlations prior to 2012 were positive, and after 2012 negative.

Here is what my data (taken from an Excel doc) look like:
2000	DIV/0!
2001	DIV/0!
2002	DIV/0!
2003	0.84
2004	0.86
2005	0.79
2006	0.83
2007	0.87
2008	0.47
2009	0.27
2010	0.25
2011	0.22
2012	8.09E-05
2013	-0.19
2014	-0.29
2015	-0.36
2016	-0.42

For 2000-2002, and 2012, I will make an annotation to make clear that a correlation was not available for that year. 





```{r DeleteA dataframe}   
rm(ggp1)
```



